<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ä°ngilizce Bilgi KartlarÄ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
		.scene {
            width: 100%;
            max-width: 500px;
            height: 520px; /* VarsayÄ±lan baÅŸlangÄ±Ã§ yÃ¼ksekliÄŸi */
            perspective: 1000px;
            /* YÃ¼kseklik deÄŸiÅŸimini yumuÅŸak hale getiren animasyon */
            transition: height 0.4s ease-in-out;
        }
        .card {
            width: 100%;
            height: 100%;
            position: relative;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.8s;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border-radius: 1.5rem;
        }
        .card.is-flipped {
            transform: rotateY(180deg);
        }
        .card__face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            border-radius: 1.5rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 1.5rem;
            overflow-y: auto;
        }
        .card__face--front {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-family: 'Nunito', sans-serif;
        }
        .card__face--back {
            background-color: #ffffff;
            color: #334155;
            transform: rotateY(180deg);
            font-size: 0.9rem;
            justify-content: center;
            align-items: flex-start;
            text-align: left;
            cursor: default;
        }
        .action-button {
            transition: all 0.2s ease-in-out;
        }
        .action-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .action-button:active {
            transform: translateY(0);
        }
        .action-button:disabled {
            background-color: #e2e8f0;
            color: #94a3b8;
            cursor: not-allowed;
        }
        .toast {
            transition: all 0.4s ease-in-out;
            opacity: 0;
            transform: translateY(-150%);
        }
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <div id="toast-container" class="fixed top-5 left-1/2 -translate-x-1/2 space-y-3 z-50 w-full max-w-xs sm:max-w-sm md:max-w-md"></div>

    <div id="deck-selection-view" class="w-full max-w-2xl">
        <h1 class="text-3xl sm:text-4xl text-center font-bold text-slate-800 mb-6" style="font-family: 'Nunito', sans-serif;">Ã‡alÄ±ÅŸma Setlerim</h1>
        <div id="deck-list" class="space-y-4">
            </div>
        <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 gap-4">
            <button id="import-deck-btn" class="action-button w-full bg-white text-indigo-600 font-semibold py-3 rounded-lg shadow-md border border-indigo-200 hover:bg-indigo-50">
                Set Ä°Ã§e Aktar (.txt)
            </button>
            <button id="add-new-deck-btn" class="action-button w-full bg-indigo-600 text-white font-semibold py-3 rounded-lg shadow-md">
                Yeni Set OluÅŸtur
            </button>
            <input type="file" id="import-file-input" class="hidden" accept=".txt">
        </div>
    </div>

<div id="learning-view" class="w-full max-w-2xl flex flex-col items-center" style="margin-top: -100px;">
        <h1 id="learning-deck-title" class="text-3xl sm:text-4xl text-center font-bold text-slate-800 mb-2" style="font-family: 'Nunito', sans-serif;"></h1>
        <button id="back-to-decks-btn" class="mb-4 text-indigo-600 hover:text-indigo-800 font-semibold">â† Setlere Geri DÃ¶n</button>
        
        <div id="progress-container" class="w-full max-w-md mb-4 text-center">
             <div class="flex justify-start items-center">
                 <p class="text-lg font-semibold text-slate-700">Ã–ÄŸrenilen: <span id="mastered-count">0</span> / <span id="total-count">0</span></p>
             </div>
             <div class="w-full bg-slate-200 rounded-full h-2.5 mt-2">
                 <div id="progress-bar" class="bg-indigo-600 h-2.5 rounded-full" style="width: 0%"></div>
             </div>
        </div>

        <div class="scene mb-8">
            <div id="card" class="card">
                <div id="card-front" class="card__face card__face--front"></div>
                <div id="card-back" class="card__face card__face--back"></div>
            </div>
        </div>
        
        <div id="completion-screen" class="hidden text-center p-8 bg-white rounded-2xl shadow-xl">
            <h2 class="text-3xl font-bold text-green-600 mb-4">Harika Ä°ÅŸ! ğŸ‰</h2>
            <p class="text-slate-700 text-lg mb-6">Bu setteki tÃ¼m kelimeleri Ã¶ÄŸrendin.</p>
            <button id="restart-btn" class="action-button bg-indigo-600 text-white font-semibold py-3 px-8 rounded-full shadow-lg">
                Seti Tekrar Ã‡alÄ±ÅŸ
            </button>
        </div>
    </div>

	<div id="deck-editor-view" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col">
            <div class="p-6 border-b">
                <h2 id="editor-title" class="text-2xl font-bold text-slate-800">Seti DÃ¼zenle</h2>
            </div>
            <div class="p-6 overflow-y-auto space-y-6">
                <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                    <div class="flex-grow w-full">
                        <label for="deck-name-input" class="block text-sm font-medium text-slate-700 mb-1">Set AdÄ±</label>
                        <input type="text" id="deck-name-input" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div class="ml-0 sm:ml-6 flex items-center space-x-2 p-2 rounded-md self-end sm:self-center mt-2.5">
                        <label for="deck-test-mode-toggle" class="text-sm font-medium text-slate-600 cursor-pointer">Bilgini Test Et</label>
                        <button id="deck-test-mode-toggle" class="relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none">
                            <span class="pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"></span>
                        </button>
                    </div>
                </div>
                <div id="card-editor-list" class="space-y-4">
                    </div>
                <button id="add-new-card-btn" class="action-button w-full bg-slate-200 text-slate-700 font-semibold py-2 rounded-lg">
                    + Kart Ekle
                </button>
            </div>
            <div class="p-6 border-t flex flex-col sm:flex-row justify-between items-center gap-4">
                 <div class="flex items-center gap-2">
                    <button id="reset-progress-btn" class="action-button bg-amber-100 text-amber-700 font-semibold py-2 px-4 rounded-lg border border-amber-200 hidden">Ä°lerlemeyi SÄ±fÄ±rla</button>
                    <button id="export-deck-btn-editor" class="action-button bg-slate-100 text-slate-700 font-semibold py-2 px-4 rounded-lg border border-slate-200 hidden">Seti DÄ±ÅŸa Aktar</button>
                 </div>
                 <div class="flex space-x-4">
                     <button id="cancel-deck-edit-btn" class="action-button bg-white text-slate-700 font-semibold py-2 px-6 rounded-lg border border-slate-300">Ä°ptal</button>
                     <button id="save-deck-btn" class="action-button bg-green-500 text-white font-semibold py-2 px-6 rounded-lg">Kaydet</button>
                 </div>
            </div>
        </div>
    </div>

    <script>
        const initialDecks = [
            {
                id: 1,
                name: "Ä°ngilizce BaÄŸlaÃ§lar ve Edatlar",
                testMode: true,
                cards: [
                    { id: 1, english: "and", turkish: "ve", usage: "CÃ¼mleleri veya Ã¶ÄŸeleri birbirine baÄŸlar.", example: "I bought apples and oranges.", translation: "Elma ve portakal aldÄ±m." },
                    { id: 2, english: "or", turkish: "veya, ya da", usage: "SeÃ§im veya alternatif sunar.", example: "Do you want tea or coffee?", translation: "Ã‡ay mÄ± yoksa kahve mi istersin?" },
                    { id: 3, english: "but", turkish: "ama, fakat", usage: "ZÄ±tlÄ±k belirtir.", example: "I wanted to go, but it rained.", translation: "Gitmek istedim ama yaÄŸmur yaÄŸdÄ±." },
                    { id: 4, english: "nor", turkish: "ne de", usage: "Olumsuz bir baÄŸlaÃ§ olup, bir Ã¶nceki olumsuz ifadeye ekleme yapar.", example: "He didnâ€™t call, nor did he text.", translation: "AramadÄ±, mesaj da atmadÄ±." },
                    { id: 5, english: "yet", turkish: "ama, yine de", usage: "Bir Ã¶nceki ifadeye gÃ¶re hafif bir zÄ±tlÄ±k veya beklenmedik bir durum belirtir.", example: "It was late, yet he continued working.", translation: "GeÃ§ olmasÄ±na raÄŸmen Ã§alÄ±ÅŸmaya devam etti." },
                    { id: 6, english: "so", turkish: "bu yÃ¼zden, bu nedenle", usage: "Bir Ã¶nceki durumun sonucunu ifade eder.", example: "It was cold, so I wore a coat.", translation: "Hava soÄŸuktu, bu yÃ¼zden mont giydim." },
                    { id: 7, english: "because", turkish: "Ã§Ã¼nkÃ¼, -dÄ±ÄŸÄ± iÃ§in", usage: "Bir eylemin sebebini aÃ§Ä±klar.", example: "I stayed home because it was raining.", translation: "YaÄŸmur yaÄŸdÄ±ÄŸÄ± iÃ§in evde kaldÄ±m." },
                    { id: 8, english: "since", turkish: "-dÄ±ÄŸÄ± iÃ§in", usage: "Bir durumun mantÄ±ksal sonucunu veya sebebini belirtir.", example: "Since he was tired, he went to bed early.", translation: "Yorgun olduÄŸu iÃ§in erken yattÄ±." },
                    { id: 9, english: "as", turkish: "-dÄ±ÄŸÄ± iÃ§in, -den dolayÄ±", usage: "'Because' ile benzer ÅŸekilde sebep-sonuÃ§ iliÅŸkisi kurar.", example: "As it was late, we decided to leave.", translation: "GeÃ§ olduÄŸu iÃ§in ayrÄ±lmaya karar verdik." },
                    { id: 10, english: "therefore", turkish: "bu nedenle, bu yÃ¼zden", usage: "Ã–ncesinde belirtilen bir durumun sonucunu vurgular.", example: "She studied hard; therefore, she passed.", translation: "Ã‡ok Ã§alÄ±ÅŸtÄ±; bu nedenle geÃ§ti." },
                    { id: 11, english: "thus", turkish: "bÃ¶ylece", usage: "Bir eylemin veya durumun sonucunu ifade eder ve genellikle resmi bir dilde kullanÄ±lÄ±r.", example: "He didnâ€™t study, thus he failed.", translation: "Ã‡alÄ±ÅŸmadÄ±, bÃ¶ylece kaldÄ±." },
                    { id: 12, english: "so that", turkish: "-sÄ±n diye, -mek iÃ§in", usage: "Bir eylemin amacÄ±nÄ± veya hedefini belirtir.", example: "I spoke slowly so that everyone could understand.", translation: "Herkes anlayabilsin diye yavaÅŸ konuÅŸtum." },
                    { id: 13, english: "although / though / even though", turkish: "-e raÄŸmen", usage: "Ana fikirle zÄ±t olan bir durumu ifade eder.", example: "Although it rained, we went out.", translation: "YaÄŸmur yaÄŸmasÄ±na raÄŸmen dÄ±ÅŸarÄ± Ã§Ä±ktÄ±k." },
                    { id: 14, english: "whereas / while", turkish: "oysa, halbuki", usage: "Ä°ki farklÄ± ÅŸey arasÄ±ndaki zÄ±tlÄ±ÄŸÄ± veya karÅŸÄ±laÅŸtÄ±rmayÄ± belirtir.", example: "He likes tea, whereas I prefer coffee.", translation: "O Ã§ayÄ± sever, oysa ben kahveyi tercih ederim." },
                    { id: 15, english: "however", turkish: "ancak, yine de", usage: "Bir Ã¶nceki cÃ¼mleye zÄ±t bir fikir sunar.", example: "I wanted to join; however, I was busy.", translation: "KatÄ±lmak istedim; ancak meÅŸguldÃ¼m." },
                    { id: 16, english: "nevertheless / nonetheless", turkish: "yine de, buna raÄŸmen", usage: "Ã–ncesinde belirtilen duruma raÄŸmen beklenmeyen bir durumu ifade eder.", example: "It was raining; nevertheless, they played football.", translation: "YaÄŸmur yaÄŸÄ±yordu; yine de futbol oynadÄ±lar." },
                    { id: 17, english: "if", turkish: "eÄŸer, -se", usage: "Bir koÅŸula baÄŸlÄ± olarak gerÃ§ekleÅŸecek bir durumu belirtir.", example: "If it rains, we will stay home.", translation: "EÄŸer yaÄŸmur yaÄŸarsa, evde kalacaÄŸÄ±z." },
                    { id: 18, english: "unless", turkish: "-medikÃ§e, -mezse", usage: "Olumsuz bir koÅŸulu ifade eder. 'EÄŸer ... deÄŸilse' anlamÄ±na gelir.", example: "I wonâ€™t go unless you come.", translation: "Sen gelmedikÃ§e gitmeyeceÄŸim." },
                    { id: 19, english: "provided that / providing that", turkish: "ÅŸartÄ±yla", usage: "Bir koÅŸulun yerine getirilmesi halinde bir eylemin gerÃ§ekleÅŸeceÄŸini belirtir.", example: "You can borrow it provided that you return it.", translation: "Geri getirmen ÅŸartÄ±yla Ã¶dÃ¼nÃ§ alabilirsin." },
                    { id: 20, english: "as long as", turkish: "sÃ¼rece", usage: "Bir eylemin belirli bir sÃ¼re veya koÅŸul boyunca devam edeceÄŸini ifade eder.", example: "You can stay here as long as you are quiet.", translation: "Sessiz olduÄŸun sÃ¼rece burada kalabilirsin." },
                    { id: 21, english: "when", turkish: "-dÄ±ÄŸÄ±nda, -iken", usage: "Bir eylemin ne zaman gerÃ§ekleÅŸtiÄŸini belirtir.", example: "Call me when you arrive.", translation: "VardÄ±ÄŸÄ±nda beni ara." },
                    { id: 22, english: "while", turkish: "-iken", usage: "Ä°ki eylemin aynÄ± anda gerÃ§ekleÅŸtiÄŸini belirtir.", example: "I read while he cooked.", translation: "O yemek yaparken ben okudum." },
                    { id: 23, english: "before", turkish: "-den Ã¶nce", usage: "Bir eylemin diÄŸerinden Ã¶nce gerÃ§ekleÅŸtiÄŸini belirtir.", example: "Wash your hands before eating.", translation: "Yemekten Ã¶nce ellerini yÄ±ka." },
                    { id: 24, english: "after", turkish: "-den sonra", usage: "Bir eylemin diÄŸerinden sonra gerÃ§ekleÅŸtiÄŸini belirtir.", example: "We left after the movie ended.", translation: "Film bittikten sonra ayrÄ±ldÄ±k." },
                    { id: 25, english: "until / till", turkish: "-e kadar", usage: "Bir eylemin ne zamana kadar devam edeceÄŸini belirtir.", example: "Wait here until I return.", translation: "DÃ¶nene kadar burada bekle." },
                    { id: 26, english: "as soon as", turkish: "-er ... -mez, olur olmaz", usage: "Bir eylemin, diÄŸer eylem biter bitmez gerÃ§ekleÅŸeceÄŸini ifade eder.", example: "I called her as soon as I arrived.", translation: "VardÄ±ÄŸÄ±m olur olmaz onu aradÄ±m." },
                    { id: 27, english: "in spite of / despite", turkish: "-e raÄŸmen", usage: "Bir zÄ±tlÄ±ÄŸÄ± veya beklenmeyen bir durumu vurgular.", example: "In spite of the rain, we went out.", translation: "YaÄŸmura raÄŸmen dÄ±ÅŸarÄ± Ã§Ä±ktÄ±k." },
                    { id: 28, english: "because of / due to", turkish: "-den dolayÄ±, yÃ¼zÃ¼nden", usage: "Bir durumun sebebini aÃ§Ä±klar.", example: "The flight was canceled because of fog.", translation: "Sis yÃ¼zÃ¼nden uÃ§uÅŸ iptal edildi." },
                    { id: 29, english: "in order to / so as to", turkish: "-mek iÃ§in, amacÄ±yla", usage: "Bir eylemin amacÄ±nÄ± veya hedefini belirtir.", example: "He studies hard in order to pass the exam.", translation: "SÄ±navÄ± geÃ§mek iÃ§in Ã§ok Ã§alÄ±ÅŸÄ±yor." },
                    { id: 30, english: "according to", turkish: "-e gÃ¶re", usage: "Bir bilginin kaynaÄŸÄ±nÄ± veya referansÄ±nÄ± belirtir.", example: "According to the report, sales increased.", translation: "Raporlara gÃ¶re satÄ±ÅŸlar arttÄ±." },
                    { id: 31, english: "as for / regarding", turkish: "... hakkÄ±nda, -e gelince", usage: "Konu deÄŸiÅŸtirmek veya yeni bir konuya geÃ§mek iÃ§in kullanÄ±lÄ±r.", example: "As for the meeting, it is postponed.", translation: "ToplantÄ±ya gelince, ertelendi." },
                    { id: 32, english: "besides", turkish: "ayrÄ±ca", usage: "Bir fikre ek olarak yeni bir bilgi ekler.", example: "I donâ€™t want to go; besides, itâ€™s late.", translation: "Gitmek istemiyorum; ayrÄ±ca, zaten geÃ§ oldu." },
                    { id: 33, english: "whatâ€™s more", turkish: "dahasÄ±, Ã¼stelik", usage: "Daha Ã¶nce bahsedilen bir fikri vurgulamak iÃ§in kullanÄ±lÄ±r.", example: "She is smart; whatâ€™s more, she is funny.", translation: "Zeki; dahasÄ±, komik biri." },
                    { id: 34, english: "plus", turkish: "hem de, ayrÄ±ca", usage: "Gayriresmi bir dilde, bir ÅŸeye ek bir Ã¶zellik veya fayda ekler.", example: "Itâ€™s cheap, plus it tastes good.", translation: "Ucuz, hem de tadÄ± gÃ¼zel." },
                    { id: 35, english: "still", turkish: "yine de", usage: "Bir Ã¶nceki duruma raÄŸmen gerÃ§ekleÅŸecek bir eylemi belirtir.", example: "Itâ€™s raining. Still, Iâ€™ll go out.", translation: "YaÄŸmur yaÄŸÄ±yordu. Yine de dÄ±ÅŸarÄ± Ã§Ä±kacaÄŸÄ±m." },
                    { id: 36, english: "though (cÃ¼mle sonunda)", turkish: "ama, yine de", usage: "CÃ¼mlenin sonuna eklenerek hafif bir zÄ±tlÄ±k veya Ã§ekince belirtir.", example: "Itâ€™s nice. Expensive, though.", translation: "GÃ¼zel. Ama pahalÄ±." },
                    { id: 37, english: "anyway", turkish: "neyse, her ÅŸeye raÄŸmen", usage: "Konu deÄŸiÅŸtirmek veya Ã¶nceki bir durumu geÃ§ersiz kÄ±lmak iÃ§in kullanÄ±lÄ±r.", example: "It was bad. Anyway, forget it.", translation: "KÃ¶tÃ¼ydÃ¼. Neyse, boÅŸver gitsin." },
                    { id: 38, english: "otherwise", turkish: "yoksa, aksi takdirde", usage: "Belirtilen koÅŸulun gerÃ§ekleÅŸmemesi durumunda ortaya Ã§Ä±kacak olumsuz sonucu ifade eder.", example: "Hurry up, otherwise weâ€™ll be late.", translation: "Acele et, yoksa geÃ§ kalacaÄŸÄ±z." },
                    { id: 39, english: "or else", turkish: "yoksa, aksi halde", usage: "Daha sert bir uyarÄ± veya tehdit iÃ§erir.", example: "Work hard, or else youâ€™ll fail.", translation: "Ã‡ok Ã§alÄ±ÅŸ, yoksa kalÄ±rsÄ±n." },
                    { id: 40, english: "just in case", turkish: "ne olur ne olmaz diye", usage: "Bir duruma karÅŸÄ± Ã¶nlem almak iÃ§in kullanÄ±lÄ±r.", example: "Take an umbrella, just in case.", translation: "Åemsiye al, ne olur ne olmaz." },
                    { id: 41, english: "by the time", turkish: "-dÄ±ÄŸÄ±nda, -e kadar", usage: "Bir eylem gerÃ§ekleÅŸtiÄŸinde diÄŸerinin Ã§oktan bitmiÅŸ olduÄŸunu vurgular.", example: "By the time I arrived, he had left.", translation: "Ben vardÄ±ÄŸÄ±mda o gitmiÅŸti bile." },
                    { id: 42, english: "right after", turkish: "hemen sonra", usage: "Bir eylemin diÄŸerinin hemen ardÄ±ndan gerÃ§ekleÅŸeceÄŸini belirtir.", example: "Call me right after dinner.", translation: "Yemekten hemen sonra ara." },
                    { id: 43, english: "at the same time", turkish: "aynÄ± anda", usage: "Ä°ki veya daha fazla eylemin aynÄ± anda gerÃ§ekleÅŸtiÄŸini belirtir.", example: "We talked at the same time.", translation: "AynÄ± anda konuÅŸtuk." },
                    { id: 44, english: "you know", turkish: "bilirsin ya, hani", usage: "DÃ¼ÅŸÃ¼nmek iÃ§in zaman kazanmak veya bir fikri netleÅŸtirmek iÃ§in kullanÄ±lÄ±r.", example: "It was, you know, strange.", translation: "Hani, biraz garipti." },
                    { id: 45, english: "I mean", turkish: "yani, demek istiyorum ki", usage: "Bir Ã¶nceki ifadeyi aÃ§Ä±klamak veya dÃ¼zeltmek iÃ§in kullanÄ±lÄ±r.", example: "Heâ€™s nice, I mean, most of the time.", translation: "Ä°yi biri, yani, Ã§oÄŸu zaman Ã¶yle." },
                    { id: 46, english: "like", turkish: "ÅŸey, sanki", usage: "CÃ¼mle iÃ§inde bir duraksama yaratmak veya benzetme kurmak iÃ§in kullanÄ±lÄ±r.", example: "It was, like, amazing.", translation: "Åey, inanÄ±lmazdÄ±." },
                ]
            }
        ];

        const DOM = {
            deckSelectionView: document.getElementById('deck-selection-view'),
            learningView: document.getElementById('learning-view'),
            deckEditorView: document.getElementById('deck-editor-view'),
            deckList: document.getElementById('deck-list'),
            addNewDeckBtn: document.getElementById('add-new-deck-btn'),
            learningDeckTitle: document.getElementById('learning-deck-title'),
            backToDecksBtn: document.getElementById('back-to-decks-btn'),
            card: document.getElementById('card'),
            cardFront: document.getElementById('card-front'),
            cardBack: document.getElementById('card-back'),
            restartBtn: document.getElementById('restart-btn'),
            completionScreen: document.getElementById('completion-screen'),
            masteredCount: document.getElementById('mastered-count'),
            totalCount: document.getElementById('total-count'),
            progressBar: document.getElementById('progress-bar'),
            editorTitle: document.getElementById('editor-title'),
            deckNameInput: document.getElementById('deck-name-input'),
            cardEditorList: document.getElementById('card-editor-list'),
            addNewCardBtn: document.getElementById('add-new-card-btn'),
            cancelDeckEditBtn: document.getElementById('cancel-deck-edit-btn'),
            saveDeckBtn: document.getElementById('save-deck-btn'),
            importDeckBtn: document.getElementById('import-deck-btn'),
            importFileInput: document.getElementById('import-file-input'),
            deckTestModeToggle: document.getElementById('deck-test-mode-toggle'),
            resetProgressBtn: document.getElementById('reset-progress-btn'),
        };

        let appState = {
            decks: [],
            progressData: {}, // YENÄ°: Ä°lerleme verilerini tutacak nesne
            currentDeck: null,
            currentTestMode: true,
            learningData: [],
            currentCard: null,
            recognition: null,
            editingDeckId: null,
        };
        const MASTERY_LEVEL = 3;

        // --- DATA MANAGEMENT ---
        function loadDecks() {
            const decksJSON = localStorage.getItem('flashcardDecks');
            if (decksJSON) {
                appState.decks = JSON.parse(decksJSON);
                appState.decks.forEach(deck => {
                    if (deck.testMode === undefined) deck.testMode = true;
                });
            } else {
                appState.decks = initialDecks;
                saveDecks();
            }
        }

        function saveDecks() {
            localStorage.setItem('flashcardDecks', JSON.stringify(appState.decks));
        }

        // YENÄ°: Ä°lerleme verilerini yÃ¼klemek ve kaydetmek iÃ§in fonksiyonlar
        function loadProgress() {
            const progressJSON = localStorage.getItem('flashcardProgress');
            if (progressJSON) {
                appState.progressData = JSON.parse(progressJSON);
            }
        }

        function saveProgress() {
            localStorage.setItem('flashcardProgress', JSON.stringify(appState.progressData));
        }
        
        // YENÄ°: Tek bir kartÄ±n ilerlemesini gÃ¼ncelleyip kaydeden fonksiyon
        function updateCardProgress(deckId, cardId, newMastery) {
            if (!appState.progressData[deckId]) {
                appState.progressData[deckId] = {};
            }
            appState.progressData[deckId][cardId] = newMastery;
            saveProgress();
        }

        // YENÄ°: Bir setin tÃ¼m ilerlemesini sÄ±fÄ±rlayan fonksiyon
        function resetDeckProgress(deckId) {
            if (appState.progressData[deckId]) {
                delete appState.progressData[deckId];
                saveProgress();
            }
        }
		
		function speakText(textToSpeak) {
            if (!'speechSynthesis' in window) {
                showToast('TarayÄ±cÄ±nÄ±z sesli okuma Ã¶zelliÄŸini desteklemiyor.', 'warning');
                return;
            }
            window.speechSynthesis.cancel(); // Ã–nceki konuÅŸmayÄ± iptal et
            const utterance = new SpeechSynthesisUtterance(textToSpeak);
            utterance.lang = 'en-US'; // Ä°ngilizce aksanÄ±yla okunmasÄ±nÄ± saÄŸla
            utterance.rate = 0.9; // Okuma hÄ±zÄ±nÄ± ayarla
            window.speechSynthesis.speak(utterance);
        }

        // --- VIEW MANAGEMENT ---
        function showView(viewName) {
            ['deck-selection-view', 'learning-view', 'deck-editor-view'].forEach(viewId => {
                document.getElementById(viewId)?.classList.add('hidden');
            });
            document.getElementById(viewName)?.classList.remove('hidden');
        }

        // --- DECK SELECTION VIEW ---
		function renderDeckSelectionView() {
            DOM.deckList.innerHTML = '';
            if (appState.decks.length === 0) {
                 DOM.deckList.innerHTML = `<p class="text-center text-slate-500">HenÃ¼z bir Ã§alÄ±ÅŸma setiniz yok. BaÅŸlamak iÃ§in bir tane oluÅŸturun!</p>`;
            }
            appState.decks.forEach(deck => {
                const deckProgress = appState.progressData[deck.id] || {};
                const masteredCount = Object.values(deckProgress).filter(m => m >= MASTERY_LEVEL).length;

                const deckElement = document.createElement('div');
                deckElement.className = 'bg-white p-4 rounded-lg shadow-sm flex flex-col sm:flex-row items-center justify-between gap-4';
                deckElement.innerHTML = `
                        <div class="flex-grow text-center sm:text-left">
                            <h3 class="font-bold text-xl text-slate-800">${deck.name}</h3>
                            <p class="text-sm text-slate-500">${deck.cards.length} kart Â· ${masteredCount} Ã¶ÄŸrenildi</p>
                        </div>
                        <div class="flex items-center gap-4">
                            <div class="flex items-center gap-2">
                                <button data-action="edit" data-id="${deck.id}" class="action-button p-2 rounded-full bg-slate-100 text-slate-500 hover:bg-indigo-100 hover:text-indigo-600 transition-colors" title="DÃ¼zenle">
                                    <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="m5.433 13.917 1.262-3.155A4 4 0 0 1 7.58 9.42l6.92-6.918a2.121 2.121 0 0 1 3 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 0 1-.65-.65Z" /><path d="M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0 0 10 3H4.75A2.75 2.75 0 0 0 2 5.75v9.5A2.75 2.75 0 0 0 4.75 18h9.5A2.75 2.75 0 0 0 17 15.25V10a.75.75 0 0 0-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5Z" /></svg>
                                </button>
									<button data-action="delete" data-id="${deck.id}" class="action-button p-2 rounded-full bg-slate-100 text-slate-500 hover:bg-red-100 hover:text-red-600 transition-colors" title="Sil">
										<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
											<path d="M3 6H21M5 6V20C5 21.1046 5.89543 22 7 22H17C18.1046 22 19 21.1046 19 20V6M8 6V4C8 2.89543 8.89543 2 10 2H14C15.1046 2 16 2.89543 16 4V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
											<path d="M14 11V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
											<path d="M10 11V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
										</svg>
									</button>
                            </div>
                            <button data-action="start" data-id="${deck.id}" class="action-button bg-green-600 text-white font-bold py-2 px-6 rounded-full shadow-md hover:bg-green-700">Ã‡alÄ±ÅŸ</button>
                        </div>
                        `;
                DOM.deckList.appendChild(deckElement);
            });
            showView('deck-selection-view');
        }

        DOM.deckList.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;
            
            const action = button.dataset.action;
            const deckId = parseInt(button.dataset.id);

            if (action === 'start') startLearningSession(deckId);
            else if (action === 'edit') openDeckEditor(deckId);
            else if (action === 'export') exportDeck(deckId);
            else if (action === 'delete') {
                const deckName = appState.decks.find(d => d.id === deckId)?.name;
                if (confirm(`'${deckName}' setini silmek istediÄŸinizden emin misiniz? Bu iÅŸlem geri alÄ±namaz.`)) {
                    appState.decks = appState.decks.filter(d => d.id !== deckId);
                    resetDeckProgress(deckId); // Set silinirken ilerlemesi de siliniyor.
                    saveDecks();
                    renderDeckSelectionView();
                    showToast(`'${deckName}' seti silindi.`, 'info');
                }
            }
        });

        // --- LEARNING VIEW ---
        function startLearningSession(deckId) {
            appState.currentDeck = appState.decks.find(d => d.id === deckId);
            if (!appState.currentDeck || appState.currentDeck.cards.length === 0) {
                showToast("Bu sette Ã§alÄ±ÅŸÄ±lacak kart bulunmuyor!", "warning");
                return;
            }
            appState.currentTestMode = appState.currentDeck.testMode;
            
            const deckProgress = appState.progressData[deckId] || {};
            appState.learningData = appState.currentDeck.cards.map(card => ({
                ...card,
                mastery: deckProgress[card.id] || 0
            }));

            DOM.learningDeckTitle.textContent = appState.currentDeck.name;
            DOM.completionScreen.classList.add('hidden');
            if(DOM.card.parentElement) {
                DOM.card.parentElement.classList.remove('hidden');
            }
            updateProgress();
            displayNextCard();
            showView('learning-view');
        }
        
        // --- DECK EDITOR VIEW ---
		function openDeckEditor(deckId = null) {
            appState.editingDeckId = deckId;
            DOM.cardEditorList.innerHTML = '';
            let deckTestMode = true;

            // DÄ±ÅŸa aktar butonunu her aÃ§Ä±lÄ±ÅŸta yÃ¶net
            const exportBtn = document.getElementById('export-deck-btn-editor');
            
            if (deckId) {
                DOM.editorTitle.textContent = 'Seti DÃ¼zenle';
                const deck = appState.decks.find(d => d.id === deckId);
                DOM.deckNameInput.value = deck.name;
                deckTestMode = deck.testMode;
                deck.cards.forEach(card => renderCardEditor(card));
                DOM.resetProgressBtn.classList.remove('hidden');

                // YENÄ°: Butonu gÃ¶ster ve click olayÄ±nÄ± ata
                exportBtn.classList.remove('hidden');
                // OlasÄ± eski event listener'larÄ± temizlemenin en kolay yolu klonlamaktÄ±r.
                exportBtn.replaceWith(exportBtn.cloneNode(true));
                document.getElementById('export-deck-btn-editor').addEventListener('click', () => {
                    exportDeck(deckId);
                });

            } else {
                DOM.editorTitle.textContent = 'Yeni Set OluÅŸtur';
                DOM.deckNameInput.value = '';
                renderCardEditor();
                DOM.resetProgressBtn.classList.add('hidden');
                exportBtn.classList.add('hidden'); // YENÄ°: Yeni set oluÅŸtururken butonu gizle
            }
            updateTestModeToggle(deckTestMode);
            showView('deck-editor-view');
        }

        function updateTestModeToggle(isTestMode) {
            const toggle = DOM.deckTestModeToggle;
            const span = toggle.querySelector('span');
            if (isTestMode) {
                toggle.classList.add('bg-indigo-600');
                toggle.classList.remove('bg-gray-300');
                span.classList.add('translate-x-5');
                span.classList.remove('translate-x-0');
            } else {
                toggle.classList.remove('bg-indigo-600');
                toggle.classList.add('bg-gray-300');
                span.classList.remove('translate-x-5');
                span.classList.add('translate-x-0');
            }
        }
        
        function renderCardEditor(card = {}) {
            const cardId = card.id || Date.now() + Math.random();
            const cardElement = document.createElement('div');
            cardElement.className = 'p-4 border rounded-lg bg-slate-50';
            cardElement.dataset.cardId = cardId;
            cardElement.innerHTML = `
                <div class="flex justify-end">
                    <button data-action="delete-card" class="text-red-500 hover:text-red-700">&times;</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" data-field="english" value="${card.english || ''}" placeholder="Ä°ngilizce" class="p-2 border rounded">
                    <input type="text" data-field="turkish" value="${card.turkish || ''}" placeholder="TÃ¼rkÃ§e" class="p-2 border rounded">
                    <textarea data-field="usage" placeholder="KullanÄ±m AmacÄ±" class="p-2 border rounded md:col-span-2">${card.usage || ''}</textarea>
                    <input type="text" data-field="example" value="${card.example || ''}" placeholder="Ã–rnek CÃ¼mle" class="p-2 border rounded">
                    <input type="text" data-field="translation" value="${card.translation || ''}" placeholder="Ã–rnek Ã‡eviri" class="p-2 border rounded">
                </div>
            `;
            DOM.cardEditorList.appendChild(cardElement);
        }

        DOM.cardEditorList.addEventListener('click', e => {
            if (e.target.closest('[data-action="delete-card"]')) {
                e.target.closest('[data-card-id]').remove();
            }
        });

        DOM.addNewCardBtn.addEventListener('click', () => renderCardEditor());

        DOM.deckTestModeToggle.addEventListener('click', () => {
            const isTestMode = DOM.deckTestModeToggle.classList.contains('bg-indigo-600');
            updateTestModeToggle(!isTestMode);
        });

        DOM.saveDeckBtn.addEventListener('click', () => {
            const name = DOM.deckNameInput.value.trim();
            if (!name) {
                alert("Set adÄ± boÅŸ olamaz!");
                return;
            }
            
            const cards = [];
            document.querySelectorAll('#card-editor-list [data-card-id]').forEach(cardEl => {
                const english = cardEl.querySelector('[data-field="english"]').value.trim();
                const turkish = cardEl.querySelector('[data-field="turkish"]').value.trim();
                if (english && turkish) {
                    cards.push({
                        id: cardEl.dataset.cardId.includes('.') ? Date.now() + Math.random() : parseInt(cardEl.dataset.cardId),
                        english: english,
                        turkish: turkish,
                        usage: cardEl.querySelector('[data-field="usage"]').value.trim(),
                        example: cardEl.querySelector('[data-field="example"]').value.trim(),
                        translation: cardEl.querySelector('[data-field="translation"]').value.trim(),
                    });
                }
            });

            const isTestMode = DOM.deckTestModeToggle.classList.contains('bg-indigo-600');

            if (appState.editingDeckId) {
                const deckIndex = appState.decks.findIndex(d => d.id === appState.editingDeckId);
                appState.decks[deckIndex].name = name;
                appState.decks[deckIndex].cards = cards;
                appState.decks[deckIndex].testMode = isTestMode;
            } else {
                appState.decks.push({
                    id: Date.now(),
                    name: name,
                    cards: cards,
                    testMode: isTestMode
                });
            }
            saveDecks();
            renderDeckSelectionView();
        });

        // --- EVENT LISTENERS ---
        DOM.addNewDeckBtn.addEventListener('click', () => openDeckEditor());
        DOM.cancelDeckEditBtn.addEventListener('click', () => renderDeckSelectionView());
        DOM.backToDecksBtn.addEventListener('click', () => renderDeckSelectionView());
        
        DOM.restartBtn.addEventListener('click', () => {
            resetDeckProgress(appState.currentDeck.id);
            startLearningSession(appState.currentDeck.id)
        });

        DOM.importDeckBtn.addEventListener('click', () => DOM.importFileInput.click());
        DOM.importFileInput.addEventListener('change', importDeck);
        
        DOM.resetProgressBtn.addEventListener('click', () => {
             if (appState.editingDeckId && confirm("Bu setteki Ã¶ÄŸrenme ilerlemenizi kalÄ±cÄ± olarak sÄ±fÄ±rlamak istediÄŸinizden emin misiniz?")) {
                 resetDeckProgress(appState.editingDeckId);
                 showToast("Ä°lerleme kalÄ±cÄ± olarak sÄ±fÄ±rlandÄ±.", "info");
                 renderDeckSelectionView(); // Ana menÃ¼yÃ¼ yenileyerek "0 Ã¶ÄŸrenildi" gÃ¶stermesi iÃ§in
                 showView('deck-editor-view'); // Editor'de kalmaya devam et
             }
        });

        // --- LEARNING LOGIC ---
        async function validateSentence(word, userSentence) {
            const checkBtn = document.getElementById('check-sentence-btn');
            const skipBtn = document.getElementById('skip-card-btn');
            
            checkBtn.disabled = true;
            skipBtn.disabled = true;
            showToast('DeÄŸerlendiriliyor...', 'info');

            const apiKey = "AIzaSyBZNDPH4T_mYhkym6sXe0nCwe5RXXQZl_Q"; 
            if (apiKey === "YAPAY_ZEKA_API_ANAHTARINIZI_BURAYA_GIRIN") {
                showToast("Yapay zeka Ã¶zelliÄŸini kullanmak iÃ§in kod iÃ§erisine API anahtarÄ±nÄ±zÄ± eklemelisiniz.", "warning");
                checkBtn.disabled = false;
                skipBtn.disabled = false;
                return;
            }

            const prompt = `Analyze the user's English sentence: '${userSentence}'. It must correctly use the phrase '${word}'. Is the sentence valid? **Crucial rule: Completely ignore simple typos like capitalization (e.g., 'i' vs 'I') and missing apostrophes (e.g., 'dont' vs 'don't').** Focus ONLY on the core grammar and the correct usage of the phrase '${word}'. If the core grammar and usage are correct despite typos, return isValid: true. Provide a very short explanation in Turkish. If the core usage is wrong, return isValid: false and explain the main error in Turkish.`;
            
            const payload = {
                 contents: [{ role: "user", parts: [{ text: prompt }] }],
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            "isValid": { "type": "BOOLEAN" },
                            "explanation": { "type": "STRING" }
                        },
                        required: ["isValid", "explanation"]
                    }
                }
            };
            
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) throw new Error(`API request failed with status ${response.status}`);
                
                const result = await response.json();
                const text = result.candidates[0].content.parts[0].text;
                const parsedJson = JSON.parse(text);

                if (parsedJson.isValid) {
                    showToast(parsedJson.explanation, 'success');
                    const cardInDeck = appState.learningData.find(c => c.id === appState.currentCard.id);
                    if (cardInDeck.mastery < MASTERY_LEVEL) cardInDeck.mastery++;
                    updateCardProgress(appState.currentDeck.id, cardInDeck.id, cardInDeck.mastery);
                    updateProgress();
                    setTimeout(displayNextCard, 2500);
                } else {
                    showToast(`${parsedJson.explanation} LÃ¼tfen tekrar dene.`, 'error');
                    checkBtn.disabled = false;
                    skipBtn.disabled = false;
                }
            } catch (error) {
                console.error("Gemini API Error:", error);
                showToast('DoÄŸrulama yapÄ±lamadÄ±. Tekrar deneyin.', 'error');
                checkBtn.disabled = false;
                skipBtn.disabled = false;
            }
        }

		function toggleExampleVisibility() {
            const exampleToggleArea = document.getElementById('example-toggle-area');
            const showExampleBtn = document.getElementById('show-example-btn');
            if(!showExampleBtn) return;
            const isExampleVisible = !showExampleBtn.textContent.includes("GÃ¶ster");

            if (!isExampleVisible) {
                exampleToggleArea.innerHTML = `
                    <button id="show-example-btn" class="action-button w-full text-center bg-slate-200 text-slate-700 font-semibold py-2 px-4 rounded-lg hover:bg-slate-300 transition-colors text-sm">Ã–rnek CÃ¼mleyi Gizle (â†‘)</button>
                    <div class="mt-2 p-3 bg-slate-100 rounded-lg">
                        <h4 class="font-bold text-slate-500 text-xs uppercase tracking-wider">Ã–rnek CÃ¼mle</h4>
                        <div class="flex items-center gap-2">
                            <p class="text-slate-800 font-medium mt-1 text-sm">"${appState.currentCard.example}"</p>
                            <button id="speak-example-btn" class="action-button p-1 rounded-full text-slate-400 hover:bg-slate-200 hover:text-indigo-600" title="Sesli Oku">
								<svg version="1.0" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="15px" height="15px" viewBox="0 0 64 64" enable-background="new 0 0 64 64" xml:space="preserve">
								<g>
									<path fill="rgb(51 65 85)" d="M59.998,28.001h-7.999c-2.211,0-4,1.789-4,4s1.789,4,4,4h7.999c2.211,0,4-1.789,4-4
										S62.209,28.001,59.998,28.001z"></path>
									<path fill="rgb(51 65 85)" d="M49.71,19.466l6.929-4c1.914-1.105,2.57-3.551,1.461-5.465c-1.102-1.914-3.547-2.57-5.46-1.465l-6.93,4
										c-1.914,1.105-2.57,3.551-1.461,5.464C45.351,19.915,47.796,20.571,49.71,19.466z"></path>
									<path fill="rgb(51 65 85)" d="M56.639,48.535l-6.929-3.999c-1.914-1.105-4.355-0.449-5.461,1.464c-1.105,1.914-0.453,4.359,1.461,5.465
										l6.93,4c1.913,1.105,4.358,0.449,5.464-1.465S58.553,49.641,56.639,48.535z"></path>
									<path fill="rgb(51 65 85)" d="M37.53,0.307c-1.492-0.625-3.211-0.277-4.359,0.867L18.343,16.001H4c-2.211,0-4,1.789-4,4v24
										C0,46.211,1.789,48,4,48h14.343l14.828,14.828C33.937,63.594,34.96,64,35.999,64c0.516,0,1.035-0.098,1.531-0.305
										c1.496-0.617,2.469-2.078,2.469-3.695V4.001C39.999,2.384,39.026,0.924,37.53,0.307z"></path>
								</g>
								</svg>                            
							</button>
                        </div>
                        <p class="text-indigo-500 italic text-sm mt-1">"${appState.currentCard.translation}"</p>
                    </div>`;
            } else {
                 exampleToggleArea.innerHTML = `
                    <button id="show-example-btn" class="action-button w-full text-center bg-slate-200 text-slate-700 font-semibold py-2 px-4 rounded-lg hover:bg-slate-300 transition-colors text-sm">Ã–rnek CÃ¼mle GÃ¶ster (â†“)</button>`;
            }

            // Event listener'larÄ± yeniden ata
            document.getElementById('show-example-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                toggleExampleVisibility();
            });

            const speakExampleBtn = document.getElementById('speak-example-btn');
            if(speakExampleBtn) {
                speakExampleBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    speakText(appState.currentCard.example);
                });
            }
        }
        
        function startSpeechRecognition() {
            if (appState.recognition) {
                appState.recognition.stop();
                return;
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                showToast("TarayÄ±cÄ±nÄ±z ses tanÄ±mayÄ± desteklemiyor.", "error");
                return;
            }

            appState.recognition = new SpeechRecognition();
            appState.recognition.lang = 'en-US';
            appState.recognition.interimResults = false;
            appState.recognition.maxAlternatives = 1;

            const micBtn = document.getElementById('mic-btn');
            const sentenceInput = document.getElementById('sentence-input');
            const originalMicIcon = micBtn.innerHTML;
            
            micBtn.innerHTML = `<svg class="w-5 h-5 animate-pulse" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Z" clip-rule="evenodd" /></svg>`;
            micBtn.classList.add('bg-red-500', 'text-white');
            micBtn.classList.remove('bg-slate-200', 'text-slate-700');

            appState.recognition.start();

            appState.recognition.onresult = (event) => {
                const speechResult = event.results[0][0].transcript;
                sentenceInput.value = speechResult;
            };

            appState.recognition.onend = () => {
                micBtn.innerHTML = originalMicIcon;
                micBtn.classList.remove('bg-red-500', 'text-white');
                micBtn.classList.add('bg-slate-200', 'text-slate-700');
                appState.recognition = null;
            };

            appState.recognition.onerror = (event) => {
                if (event.error === 'no-speech') {
                    showToast('Ses algÄ±lanamadÄ±. LÃ¼tfen tekrar deneyin.', 'warning');
                } else if (event.error !== 'aborted') {
                    console.error("Speech recognition error:", event.error);
                    showToast(`Ses tanÄ±ma hatasÄ±: ${event.error}`, 'error');
                }
            };
        }

	function displayNextCard() {
Â  Â  Â  Â  Â  Â  appState.currentCard = getNextCard();

            // DEÄÄ°ÅÄ°KLÄ°K: HatalÄ± kod satÄ±rlarÄ± dÃ¼zeltildi.
Â  Â  Â  Â  Â  Â  if (!appState.currentCard) {
                const scene = DOM.card.parentElement;
Â  Â  Â  Â  Â  Â  Â  Â  scene.style.height = 'auto'; // YÃ¼ksekliÄŸi sÄ±fÄ±rla
Â  Â  Â  Â  Â  Â  Â  Â  scene.classList.add('hidden'); // Kart alanÄ±nÄ± gizle
Â  Â  Â  Â  Â  Â  Â  Â  DOM.completionScreen.classList.remove('hidden'); // Tebrikler ekranÄ±nÄ± gÃ¶ster
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // YÃ¼kseklik artÄ±k min-height kullanÄ±yor.
Â  Â  Â  Â  Â  Â  if (appState.currentTestMode) {
Â  Â  Â  Â  Â  Â  Â  Â  // Test modunda kart, kapsayÄ±cÄ±yÄ± tam doldursun.
Â  Â  Â  Â  Â  Â  Â  Â  DOM.card.style.minHeight = ''; // min-height'i temizle
Â  Â  Â  Â  Â  Â  Â  Â  DOM.card.style.height = '100%';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // Ã–ÄŸrenme modunda, yÃ¼kseklik otomatik olsun ama %77'ten kÃ¼Ã§Ã¼k olmasÄ±n.
Â  Â  Â  Â  Â  Â  Â  Â  DOM.card.style.height = 'auto';
Â  Â  Â  Â  Â  Â  Â  Â  DOM.card.style.minHeight = '77%';
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (DOM.card.classList.contains('is-flipped')) {
Â  Â  Â  Â  Â  Â  Â  Â  DOM.card.classList.remove('is-flipped');
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  DOM.cardFront.innerHTML = `<h2 class="text-4xl md:text-5xl font-bold text-center">${appState.currentCard.english}</h2>`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const cardInfoHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-2xl font-bold text-indigo-600">${appState.currentCard.english}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="speak-word-btn" class="action-button p-1 rounded-full text-slate-400 hover:bg-slate-200 hover:text-indigo-600" title="Sesli Oku">
						<svg version="1.0" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="15px" height="15px" viewBox="0 0 64 64" enable-background="new 0 0 64 64" xml:space="preserve">
								<g>
									<path fill="currentColor" d="M59.998,28.001h-7.999c-2.211,0-4,1.789-4,4s1.789,4,4,4h7.999c2.211,0,4-1.789,4-4
										S62.209,28.001,59.998,28.001z"></path>
									<path fill="currentColor" d="M49.71,19.466l6.929-4c1.914-1.105,2.57-3.551,1.461-5.465c-1.102-1.914-3.547-2.57-5.46-1.465l-6.93,4
										c-1.914,1.105-2.57,3.551-1.461,5.464C45.351,19.915,47.796,20.571,49.71,19.466z"></path>
									<path fill="currentColor" d="M56.639,48.535l-6.929-3.999c-1.914-1.105-4.355-0.449-5.461,1.464c-1.105,1.914-0.453,4.359,1.461,5.465
										l6.93,4c1.913,1.105,4.358,0.449,5.464-1.465S58.553,49.641,56.639,48.535z"></path>
									<path fill="currentColor" d="M37.53,0.307c-1.492-0.625-3.211-0.277-4.359,0.867L18.343,16.001H4c-2.211,0-4,1.789-4,4v24
										C0,46.211,1.789,48,4,48h14.343l14.828,14.828C33.937,63.594,34.96,64,35.999,64c0.516,0,1.035-0.098,1.531-0.305
										c1.496-0.617,2.469-2.078,2.469-3.695V4.001C39.999,2.384,39.026,0.924,37.53,0.307z"></path>
								</g>
								</svg>
					</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-lg font-semibold text-slate-700 mb-3">${appState.currentCard.turkish}</p>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  ${appState.currentCard.usage ? `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-bold text-slate-500 text-xs uppercase tracking-wider">KullanÄ±m AmacÄ±</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-slate-600 text-sm">${appState.currentCard.usage}</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  ` : ''}

Â  Â  Â  Â  Â  Â  Â  Â  ${appState.currentCard.example ? `
Â  Â  Â  Â  Â  Â  Â  Â  <div id="example-toggle-area" class="my-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="show-example-btn" class="action-button w-full text-center bg-slate-200 text-slate-700 font-semibold py-2 px-4 rounded-lg hover:bg-slate-300 transition-colors text-sm">Ã–rnek CÃ¼mle GÃ¶ster (â†“)</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  ` : ''}
Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  let cardBackHTML = '';

Â  Â  Â  Â  Â  Â  if (appState.currentTestMode) {
Â  Â  Â  Â  Â  Â  Â  Â  const testModeActionsHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-auto pt-3 border-t border-slate-200 flex flex-col flex-grow">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="sentence-input" class="font-bold text-slate-500 text-xs uppercase tracking-wider mb-2">Bilgini Test Et</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="relative w-full">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="sentence-input" rows="3" class="w-full p-2 pr-20 border border-slate-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="'${appState.currentCard.english}' kelimesini iÃ§eren bir cÃ¼mle yaz..."></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="speak-input-btn" class="action-button p-2 rounded-full text-slate-500 hover:bg-slate-200 hidden" title="YazdÄ±ÄŸÄ±nÄ± Seslendir">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg class="w-4 h-4" version="1.0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" xml:space="preserve"><g><path fill="currentColor" d="M59.998,28.001h-7.999c-2.211,0-4,1.789-4,4s1.789,4,4,4h7.999c2.211,0,4-1.789,4-4S62.209,28.001,59.998,28.001z"></path><path fill="currentColor" d="M49.71,19.466l6.929-4c1.914-1.105,2.57-3.551,1.461-5.465c-1.102-1.914-3.547-2.57-5.46-1.465l-6.93,4c-1.914,1.105-2.57,3.551-1.461,5.464C45.351,19.915,47.796,20.571,49.71,19.466z"></path><path fill="currentColor" d="M56.639,48.535l-6.929-3.999c-1.914-1.105-4.355-0.449-5.461,1.464c-1.105,1.914-0.453,4.359,1.461,5.465l6.93,4c1.913,1.105,4.358,0.449,5.464-1.465S58.553,49.641,56.639,48.535z"></path><path fill="currentColor" d="M37.53,0.307c-1.492-0.625-3.211-0.277-4.359,0.867L18.343,16.001H4c-2.211,0-4,1.789-4,4v24C0,46.211,1.789,48,4,48h14.343l14.828,14.828C33.937,63.594,34.96,64,35.999,64c0.516,0,1.035-0.098,1.531-0.305c1.496-0.617,2.469-2.078,2.469-3.695V4.001C39.999,2.384,39.026,0.924,37.53,0.307z"></path></g></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="mic-btn" class="action-button p-2 rounded-full text-slate-500 hover:bg-slate-200" title="Sesli SÃ¶yle">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M8.25 4.5a3.75 3.75 0 1 1 7.5 0v8.25a3.75 3.75 0 1 1-7.5 0V4.5Z" /><path d="M6 10.5a.75.75 0 0 1 .75.75v1.5a5.25 5.25 0 1 0 10.5 0v-1.5a.75.75 0 0 1 1.5 0v1.5a6.75 6.75 0 1 1-13.5 0v-1.5A.75.75 0 0 1 6 10.5Z" /></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-auto flex space-x-2 pt-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="skip-card-btn" class="action-button w-1/3 text-center bg-slate-200 text-slate-700 font-semibold py-2 px-4 rounded-lg hover:bg-slate-300 transition-colors text-sm">Bilmiyorum</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="check-sentence-btn" class="action-button w-2/3 text-center bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors text-sm">Kontrol Et</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  Â  Â  Â  Â  cardBackHTML = `<div class="w-full h-full flex flex-col"><div class="flex-grow">${cardInfoHTML}</div>${testModeActionsHTML}</div>`;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  const learnModeActionsHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-4 pt-4 border-t border-slate-200 flex space-x-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="skip-card-btn" class="action-button w-1/2 text-center bg-slate-200 text-slate-700 font-semibold py-3 px-4 rounded-lg">Bilmiyorum</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="learned-btn" class="action-button w-1/2 text-center bg-green-500 text-white font-semibold py-3 px-4 rounded-lg">Ã–ÄŸrendim</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  Â  Â  Â  Â  cardBackHTML = `<div class="w-full">${cardInfoHTML}${learnModeActionsHTML}</div>`;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  DOM.cardBack.innerHTML = cardBackHTML;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // --- Event Listeners ---
Â  Â  Â  Â  Â  Â  const speakWordBtn = document.getElementById('speak-word-btn');
Â  Â  Â  Â  Â  Â  if(speakWordBtn) {
Â  Â  Â  Â  Â  Â  Â  Â  speakWordBtn.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.stopPropagation();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  speakText(appState.currentCard.english);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const showExampleBtn = document.getElementById('show-example-btn');
Â  Â  Â  Â  Â  Â  if (showExampleBtn) {
Â  Â  Â  Â  Â  Â  Â  Â  showExampleBtn.addEventListener('click', (e) => { e.stopPropagation(); toggleExampleVisibility(); });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('skip-card-btn').addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  e.stopPropagation();
Â  Â  Â  Â  Â  Â  Â  Â  const cardInDeck = appState.learningData.find(c => c.id === appState.currentCard.id);
Â  Â  Â  Â  Â  Â  Â  Â  cardInDeck.mastery = Math.max(0, cardInDeck.mastery - 1);
Â  Â  Â  Â  Â  Â  Â  Â  updateCardProgress(appState.currentDeck.id, cardInDeck.id, cardInDeck.mastery);
Â  Â  Â  Â  Â  Â  Â  Â  updateProgress();
Â  Â  Â  Â  Â  Â  Â  Â  displayNextCard();
Â  Â  Â  Â  Â  Â  });

            if (appState.currentTestMode) {
                const sentenceInput = document.getElementById('sentence-input');
                const speakInputBtn = document.getElementById('speak-input-btn');

                // DEÄÄ°ÅÄ°KLÄ°K: YazÄ± kutusuna yazÄ±ldÄ±kÃ§a butonu gÃ¶ster/gizle
                sentenceInput.addEventListener('input', () => {
                    if (sentenceInput.value.trim() !== '') {
                        speakInputBtn.classList.remove('hidden');
                    } else {
                        speakInputBtn.classList.add('hidden');
                    }
                });

                // DEÄÄ°ÅÄ°KLÄ°K: Yeni butona seslendirme iÅŸlevi ekle
                speakInputBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    speakText(sentenceInput.value);
                });

                document.getElementById('check-sentence-btn').addEventListener('click', (e) => { e.stopPropagation(); if(sentenceInput.value.trim() !== "") { validateSentence(appState.currentCard.english, sentenceInput.value); } });
                document.getElementById('sentence-input').addEventListener('keydown', (e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); document.getElementById('check-sentence-btn').click(); } });
                document.getElementById('mic-btn').addEventListener('click', (e) => { e.stopPropagation(); startSpeechRecognition(); });
            } else {
                document.getElementById('learned-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    const cardInDeck = appState.learningData.find(c => c.id === appState.currentCard.id);
                    if (cardInDeck.mastery < MASTERY_LEVEL) cardInDeck.mastery++;
                    updateCardProgress(appState.currentDeck.id, cardInDeck.id, cardInDeck.mastery);
                    updateProgress();
                    displayNextCard();
                });
            }
        }

        function getNextCard() {
            let deck = appState.learningData.filter(card => card.mastery < MASTERY_LEVEL);
            if (deck.length === 0) return null;
            const weightedDeck = deck.flatMap(card => { const weight = Math.max(1, (MASTERY_LEVEL - card.mastery) * 2); return Array(weight).fill(card); });
            return weightedDeck[Math.floor(Math.random() * weightedDeck.length)];
        }

        function updateProgress() {
            const mastered = appState.learningData.filter(card => card.mastery >= MASTERY_LEVEL).length;
            const total = appState.learningData.length;
            DOM.masteredCount.textContent = mastered;
            DOM.totalCount.textContent = total;
            DOM.progressBar.style.width = total > 0 ? `${(mastered / total) * 100}%` : '0%';
        }
        
        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'toast p-4 rounded-lg shadow-lg flex items-center space-x-3 text-white font-semibold';

            let bgColor, icon;
            switch (type) {
                case 'success':
                    bgColor = 'bg-green-500';
                    icon = `<svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.857-9.809a.75.75 0 0 0-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 1 0-1.06 1.061l2.5 2.5a.75.75 0 0 0 1.137-.089l4-5.5Z" clip-rule="evenodd" /></svg>`;
                    break;
                case 'error':
                    bgColor = 'bg-red-500';
                    icon = `<svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16ZM8.28 7.22a.75.75 0 0 0-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 1 0 1.06 1.06L10 11.06l1.72 1.72a.75.75 0 1 0 1.06-1.06L11.06 10l1.72-1.72a.75.75 0 0 0-1.06-1.06L10 8.94 8.28 7.22Z" clip-rule="evenodd" /></svg>`;
                    break;
                case 'warning':
                    bgColor = 'bg-amber-500';
                    icon = `<svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0ZM9 5a.75.75 0 0 1 .75.75v4.5a.75.75 0 0 1-1.5 0v-4.5A.75.75 0 0 1 9 5Zm0 8a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z" clip-rule="evenodd" /></svg>`;
                    break;
                default:
                    bgColor = 'bg-slate-700';
                    icon = `<svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0ZM9 5a.75.75 0 0 1 .75.75v4.5a.75.75 0 0 1-1.5 0v-4.5A.75.75 0 0 1 9 5Zm0 8a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z" clip-rule="evenodd" /></svg>`;
            }

            toast.classList.add(bgColor);
            toast.innerHTML = `<span>${icon}</span><p>${message}</p>`;
            container.appendChild(toast);

            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => {
                toast.classList.remove('show');
                toast.addEventListener('transitionend', () => toast.remove());
            }, 4000);
        }

        function exportDeck(deckId) {
            const deck = appState.decks.find(d => d.id === deckId);
            if (!deck) return;

            const dataStr = JSON.stringify(deck, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'text/plain'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.download = `${deck.name.replace(/ /g, '_')}.txt`;
            link.href = url;
            link.click();
            URL.revokeObjectURL(url);
        }

        function importDeck(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const deck = JSON.parse(e.target.result);
                    if (deck && deck.name && Array.isArray(deck.cards)) {
                        deck.id = Date.now();
                        appState.decks.push(deck);
                        saveDecks();
                        renderDeckSelectionView();
                        showToast(`'${deck.name}' seti baÅŸarÄ±yla iÃ§e aktarÄ±ldÄ±!`, 'success');
                    } else {
                        throw new Error('Invalid deck format');
                    }
                } catch (err) {
                    showToast('GeÃ§ersiz dosya formatÄ± veya bozuk dosya.', 'error');
                    console.error("Import error:", err);
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // --- KEYBOARD & GLOBAL LISTENERS ---
        document.addEventListener('keydown', (event) => {
            if (document.activeElement.tagName.toLowerCase() === 'textarea' || document.activeElement.tagName.toLowerCase() === 'input' || !DOM.deckEditorView.classList.contains('hidden')) return;
            if (DOM.learningView.classList.contains('hidden')) return;

            const isFlipped = DOM.card.classList.contains('is-flipped');
            if (event.code === 'Space' && !isFlipped) { event.preventDefault(); DOM.card.classList.toggle('is-flipped'); return; }
            
            if (isFlipped) {
                if(appState.currentTestMode) {
                     if (event.code === 'Escape') { event.preventDefault(); document.getElementById('skip-card-btn').click(); return; }
                } else {
                     if (event.code === 'ArrowLeft') { event.preventDefault(); document.getElementById('skip-card-btn').click(); return; }
                     if (event.code === 'ArrowRight' || event.code === 'Enter') { event.preventDefault(); document.getElementById('learned-btn').click(); return; }
                }

                const showExampleBtn = document.getElementById('show-example-btn');
                if (!showExampleBtn) return;
                if (event.code === 'ArrowDown' || event.code === 'ArrowUp') { event.preventDefault(); toggleExampleVisibility(); }
            }
        });

        DOM.card.addEventListener('click', (e) => { 
            if (e.target === DOM.card || e.target === DOM.cardFront) { 
                DOM.card.classList.toggle('is-flipped'); 
            } 
        });
        
        // --- INITIALIZE APP ---
        loadDecks();
        loadProgress(); 
        renderDeckSelectionView();

    </script>
</body>
</html>
